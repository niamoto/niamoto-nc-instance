<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Liste des Taxons - Niamoto</title>

    
    <link rel="stylesheet" href="../assets/css/vendor/tailwind/tailwind.min.css">
    <link rel="stylesheet" href="../assets/css/font-awesome/6.6.0_all.min.css">
    <!-- Base CSS with custom styles -->
    <link rel="stylesheet" href="../assets/css/niamoto.css">
    <link rel="stylesheet" href="../assets/css/niamoto_hierarchical_nav.css">

    
    
    
    
    
    
    
<style>
    .endemic-badge {
        background-color: #10b981;
        color: white;
    }

    /* Styles pour les cartes avec images */
    .items-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1.5rem;
    }

    .item-card {
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        overflow: hidden;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: transform 0.2s, box-shadow 0.2s;
        background-color: white;
    }

    .item-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    /* Conteneur flexible pour l'image et les informations */
    .item-card-content {
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    /* Images */
    .item-card-image-container {
        width: 100%;
        height: 200px;
    }

    .item-card-image {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    .item-card-image-placeholder {
        width: 100%;
        height: 100%;
        background-color: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #9ca3af;
        font-size: 0.875rem;
    }

    /* Informations de l'élément */
    .item-card-info {
        padding: 1rem;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    .item-name {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .item-name a {
        color: inherit;
        text-decoration: none;
    }

    .item-name a:hover {
        text-decoration: underline;
    }

    .item-details {
        flex-grow: 1;
    }

    .item-info {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.5rem;
        padding-bottom: 0.25rem;
        border-bottom: 1px dashed #e2e8f0;
    }

    .item-info-label {
        color: #718096;
        font-weight: 500;
    }

    .item-info-value {
        text-align: right;
        font-weight: 500;
    }

    /* Version responsive pour grands écrans */
    @media (min-width: 768px) {
        .item-card-content {
            flex-direction: row;
        }

        .item-card-image-container {
            width: 40%;
            height: auto;
        }

        .item-card-info {
            width: 60%;
        }
    }

    /* Liste responsive */
    @media (max-width: 768px) {
        .items-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Styles génériques pour les badges */
    .field-badge {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
        margin-left: 0.5rem;
        vertical-align: middle;
    }

    /* Liste simple */
    .items-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    /* Liens externes */
    .item-external-links {
        margin-top: 1rem;
        padding-top: 0.5rem;
        border-top: 1px solid #e2e8f0;
        text-align: right;
    }

    .external-link {
        display: inline-block;
        margin-left: 0.5rem;
        padding: 0.25rem 0.75rem;
        background-color: #f3f4f6;
        color: #374151;
        text-decoration: none;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: background-color 0.2s;
    }

    .external-link:hover {
        background-color: #e5e7eb;
        color: #1f2937;
    }
</style>


    <style>
        ul {
            list-style-type: none;
        }

        .loader-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        .button-container {
            transition: all 0.3s ease;
        }
        .button-container.fixed {
            position: fixed;
            top: 63px; /* Adjust this value to match the height of your navigation menu */
            left: 0;
            right: 0;
            z-index: 1000;
            background-color: white;
            padding: 10px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <nav class="bg-nav-bg nav-bg p-0 fixed w-full top-0 shadow-md z-50 custom-nav">
    <div class="container mx-auto flex flex-wrap items-center justify-between">
        <div class="flex items-center flex-shrink-0 text-white mr-6">
            <a class="inline-flex items-center py-2 px-4 text-white no-underline"
                href="../index.html">
                
                <img src="../assets/files/niamoto_logo.png" alt="Logo"
                    class="h-8 w-auto mr-2 logo-embossed">
                
                <span class="site-title">Niamoto</span>
            </a>
        </div>

        <div class="block lg:hidden">
            <button id="nav-toggle"
                class="flex items-center px-3 py-2 border rounded text-teal-200 border-teal-400 hover:text-white hover:border-white">
                <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                    <title>Menu</title>
                    <path d="M0 3h20v2H0zm0 6h20v2H0zm0 6h20v2H0z" />
                </svg>
            </button>
        </div>
        <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden lg:block pt-6 lg:pt-0" id="nav-content">
            <ul class="list-reset lg:flex justify-end flex-1 items-center">
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#" data-link="index.html">
                        <i class="fas fa-home menu-icon"></i>Accueil
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#introduction">Introduction</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#project">Projet</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#objective">Objectifs</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#context">Contexte</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="index.html#flora">Flore</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#" data-link="methodology.html">
                        <i class="fas fa-flask menu-icon"></i>Méthodologie
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#methodes">Nos méthodes</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="methodology.html#faq">FAQ</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#" data-link="trees.html">
                        <i class="fas fa-leaf menu-icon"></i>Arbres
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#learnTaxon">Étudier les
                arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="trees.html#taxon">Les arbres de
                Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#" data-link="plots.html">
                        <i class="fas fa-map-marked-alt menu-icon"></i>Peuplements
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#learnPlot">Étudier les
                            peuplements forestiers</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plots.html#plot">Les
                peuplements forestiers de Nouvelle-Calédonie</a></li>
                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#" data-link="forests.html">
                        <i class="fas fa-tree menu-icon"></i>Forêt
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#preambule">Préambule</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#learnForest">Étudier la
                forêt</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="forests.html#forestNC">La forêt de Nouvelle-Calédonie</a></li>

                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#">
                        <i class="fas fa-database menu-icon"></i>Accéder aux données
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="taxon/index.html">Arbres</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="plot/index.html">Peuplements</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="shape/index.html">Forêt</a></li>

                    </ul>
                </li>
                <li class="relative group mr-3">
                    <a class="nav-link inline-block py-2 px-3 text-white no-underline" href="#" data-link="resources.html">
                        <i class="fas fa-book menu-icon"></i>Ressources
                    </a>
                    <ul class="absolute hidden text-gray-700 pt-1 group-hover:block bg-white shadow-lg rounded-md z-50 w-48 custom-dropdown">
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#equipe">L'équipe</a></li>
                        <li><a class="py-2 px-4 block whitespace-no-wrap hover:bg-gray-100" href="#" data-link="resources.html#productions">Productions</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<script>
    // Mobile menu toggle
    document.getElementById('nav-toggle').onclick = () =>
        document.getElementById('nav-content').classList.toggle('hidden');

    // Function to adjust the navigation links based on page depth
        function adjustNavLinks(depth) {
            document.querySelectorAll('a[data-link]').forEach(link => {
                link.href = depth + link.getAttribute('data-link');
            });
        }

        // Adjust the navigation links based on the depth  
        adjustNavLinks("../");

</script>

<style>
    .site-title {
        font-family: 'Arial Black', sans-serif; /* Custom font for a bold effect */
        font-size: 2rem; /* Increased font size */
        text-transform: uppercase; /* Uppercase letters for visibility */
        letter-spacing: 2px; /* Spacing between letters */
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.7); /* Text shadow for better visibility */
        transition: color 0.3s; /* Smooth transition for hover effect */
    }

    .site-title:hover {
        color: #ffdd57; /* Change color on hover */
    }

    .text-contour {
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
    }

    .nav-bg {
        background-color: rgba(34, 139, 34, 0.8); /* Fond vert semi-transparent */
        transition: background-color 0.3s;
    }

    .nav-bg:hover {
        background-color: rgba(34, 139, 34, 1); /* Fond vert opaque au survol */
    }

    .group:hover .group-hover\:block {
        display: block;
    }

    .custom-nav {
        z-index: 1500;
    }

    .custom-dropdown {
        z-index: 1500;
    }

    .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.2); /* Fond blanc transparent au survol */
        border-radius: 4px;
    }

    .menu-icon {
        margin-right: 8px;
    }

    .logo-embossed {
        background-color: #ffffff;
        border-radius: 6px;
        box-shadow:
            /* Ombre intérieure pour l'effet enfoncé */
            inset 0 2px 4px rgba(0, 0, 0, 0.3),
            inset 0 1px 2px rgba(0, 0, 0, 0.2),
            /* Petite ombre extérieure subtile */
            0 1px 0 rgba(255, 255, 255, 0.2);
        /* Bordure subtile pour accentuer l'effet */
        border: 1px solid rgba(0, 0, 0, 0.1);
    }
</style>
    <div class="flex flex-col lg:flex-row">
        
        
        <div class="w-full">
            
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 pt-24">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">Liste des Taxons</h1>

    <!-- Recherche -->
    <div class="relative mb-8">
        <input type="text" id="searchInput"
               placeholder="Rechercher..."
               aria-label="Rechercher"
               class="w-full pl-12 pr-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-primary focus:border-primary text-sm">
        <svg class="absolute left-4 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
    </div>

    <!-- Filtres dynamiques -->
    <div class="flex flex-wrap gap-4 mb-8" id="filtersContainer">
        <!-- Les filtres seront générés dynamiquement par JavaScript -->
    </div>

    <!-- Barre de stats et toggle de vue -->
    <div class="flex justify-between items-center mb-6">
        <div id="resultCount" class="text-sm text-gray-600">Chargement...</div>
        <div class="flex gap-2">
            <button id="gridViewBtn"
                    class="p-2 border border-gray-300 rounded-md bg-green-600 text-white hover:bg-green-700 focus:ring-2 focus:ring-primary"
                    title="Vue en grille">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path
                        d="M1 2a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V2zM1 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1V7zM1 12a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1v-2zm5 0a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-2a1 1 0 0 1-1-1v-2z">
                    </path>
                </svg>
            </button>
            <button id="listViewBtn"
                    class="p-2 border border-gray-300 rounded-md bg-white text-gray-700 hover:bg-gray-50 focus:ring-2 focus:ring-primary"
                    title="Vue en liste">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5H2zM3 3H2v1h1V3z"></path>
                    <path
                        d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5zM5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1h-9z">
                    </path>
                    <path fill-rule="evenodd"
                        d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5V7zM2 7h1v1H2V7zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5H2zm1 .5H2v1h1v-1z">
                    </path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Conteneur des éléments -->
    <div class="items-grid" id="itemsContainer">
        <!-- Les éléments seront injectés ici par JavaScript -->
    </div>

    <!-- Pagination -->
    <div class="flex justify-center mt-8" id="pagination">
        <!-- Les boutons de pagination seront injectés ici -->
    </div>

    <!-- Message aucun résultat -->
    <div class="text-center py-12 text-gray-500 italic hidden" id="noResults">
        <p>Aucun élément trouvé pour cette recherche.</p>
    </div>
</div>

<!-- Modal pour afficher une image en grand -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-90 hidden z-50 flex items-center justify-center p-4">
    <div class="relative w-full h-full max-w-5xl max-h-full flex items-center justify-center mt-20">
        <!-- Bouton fermer -->
        <button onclick="closeImageModal()" class="absolute top-4 right-4 text-white hover:text-gray-300 text-3xl leading-none z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center">
            ×
        </button>

        <!-- Flèche précédente -->
        <button id="prevImageBtn" onclick="previousImage()" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 text-4xl z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center hidden">
            ‹
        </button>

        <!-- Conteneur central pour loader et image -->
        <div class="flex items-center justify-center w-full h-full min-h-96">
            <!-- Loader -->
            <div id="imageLoader" class="flex items-center justify-center">
                <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white"></div>
            </div>

            <!-- Image en grand -->
            <img id="modalImage" src="" alt="" class="max-w-full max-h-full object-contain hidden">
        </div>

        <!-- Flèche suivante -->
        <button id="nextImageBtn" onclick="nextImage()" class="absolute right-4 top-1/2 transform -translate-y-1/2 text-white hover:text-gray-300 text-4xl z-10 bg-black bg-opacity-50 rounded-full w-12 h-12 flex items-center justify-center hidden">
            ›
        </button>

        <!-- Indicateur de position -->
        <div id="imageCounter" class="absolute bottom-8 left-1/2 transform -translate-x-1/2 text-white bg-black bg-opacity-50 px-3 py-1 rounded hidden">
            <span id="currentImageIndex">1</span> / <span id="totalImages">1</span>
        </div>
    </div>
</div>

        </div>
    </div>
    <footer class="bg-green-700 text-white p-4 mt-8">
    <div class="container mx-auto">
        <div class="flex justify-center mb-4">
            <div class="bg-white p-2 w-3/5 rounded-lg shadow-md flex justify-center">
                <a class='logo' href="https://www.province-nord.nc/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="pn" src="../assets/files/pn_100.png"></figure>
                </a>
                <a class='logo' href="https://www.province-sud.nc/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="ps" src="../assets/files/ps_100.png"></figure>
                </a>
                <a class='logo' href="https://endemia.nc/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="ps" src="../assets/files/endemia_100.png"></figure>
                </a>
                <a class='logo' href="https://amap.cirad.fr/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="amap" src="../assets/files/amap_100.png"></figure>
                </a>
                <a class='logo' href="http://publish.plantnet-project.org/project/nou" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="herbarium" src="../assets/files/herbarium_100.png"></figure>
                </a>
                <a class='logo' href="https://iac.nc/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="iac" src="../assets/files/iac_100.png"></figure>
                </a>
                <a class='logo' href="https://nouvelle-caledonie.ird.fr/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="ird" src="../assets/files/ird_100.png"></figure>
                </a>
                <a class='logo' href="https://cirad.fr/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="cirad" src="../assets/files/cirad_100.png"></figure>
                </a>
                <a class='logo' href="https://www.ofb.gouv.fr/" target="_blank">
                    <figure class="mx-2"><img class="img-fluid" id="ofb" src="../assets/files/ofb_100.png"></figure>
                </a>
            </div>
        </div>
        <div class="text-center">
            <p>Niamoto - Portail de la forêt de Nouvelle-Calédonie</p>
            <a class="inline-block py-2 px-4 text-white no-underline" href="https://github.com/niamoto/niamoto" target="_blank">
                <span class="fab fa-github fa-lg" aria-hidden="true"></span> Github
            </a>
        </div>
    </div>
</footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
        const buttonContainer = document.getElementById('buttonContainer');

            // Only proceed if the button container exists
            if (buttonContainer) {
                const buttonContainerOffset = buttonContainer.offsetTop;
                const navHeight = 60; // Adjust this value to match your navigation height

                window.onscroll = () => {
                    if (window.pageYOffset > buttonContainerOffset - navHeight) {
                        buttonContainer.classList.add('fixed');
                    } else {
                        buttonContainer.classList.remove('fixed');
                    }
                };

                // Initial check in case the page is loaded scrolled
                window.onscroll();
            }
        });
    </script>
    
<script>
    // Configuration et données injectées par le plugin
    const indexConfig = {"display_fields": [{"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": false, "fallback": "full_name", "false_label": null, "filter_options": null, "format": null, "image_fields": null, "inline_badge": false, "label": "Nom scientifique", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": null, "name": "name", "searchable": true, "source": "general_info.name.value", "tooltip_mapping": null, "true_label": null, "type": "text"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": [{"label": "Esp\u00e8ce", "value": "species"}, {"label": "Sous-esp\u00e8ce", "value": "infra"}], "format": "map", "image_fields": null, "inline_badge": false, "label": "Rang taxonomique", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": {"infra": "Sous-esp\u00e8ce", "species": "Esp\u00e8ce"}, "name": "rank", "searchable": false, "source": "general_info.rank.value", "tooltip_mapping": null, "true_label": null, "type": "select"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": true, "fallback": null, "false_label": null, "filter_options": null, "format": null, "image_fields": null, "inline_badge": false, "label": "Famille", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": null, "name": "parent_family", "searchable": false, "source": "general_info.parent_family.value", "tooltip_mapping": null, "true_label": null, "type": "select"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": null, "format": null, "image_fields": null, "inline_badge": false, "label": "Genre", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": null, "name": "parent_genus", "searchable": false, "source": "general_info.parent_genus.value", "tooltip_mapping": null, "true_label": null, "type": "text"}, {"badge_color": "bg-green-600 text-white px-2 py-1 rounded-full text-xs font-semibold ml-2", "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": null, "format": "badge", "image_fields": null, "inline_badge": true, "label": "End\u00e9misme", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": null, "name": "endemic", "searchable": false, "source": "general_info.endemic.value", "tooltip_mapping": null, "true_label": "End\u00e9mique", "type": "boolean"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": null, "format": "number", "image_fields": null, "inline_badge": false, "label": "Nombre d\u0027occurrences", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": null, "name": "occurrences_count", "searchable": false, "source": "general_info.occurrences_count.value", "tooltip_mapping": null, "true_label": null, "type": "text"}, {"badge_color": null, "badge_colors": {"CR": "bg-red-600 text-white px-2 py-1 rounded-full text-xs font-semibold ml-2", "DD": "bg-gray-500 text-white px-2 py-1 rounded-full text-xs font-semibold ml-2", "EN": "bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-semibold ml-2", "LC": "bg-green-600 text-white px-2 py-1 rounded-full text-xs font-semibold ml-2", "NE": "bg-gray-400 text-black px-2 py-1 rounded-full text-xs font-semibold ml-2", "NT": "bg-green-700 text-white px-2 py-1 rounded-full text-xs font-semibold ml-2", "VU": "bg-yellow-400 text-black px-2 py-1 rounded-full text-xs font-semibold ml-2"}, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "normal", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": [{"label": "En danger critique (CR)", "value": "CR"}, {"label": "En danger (EN)", "value": "EN"}, {"label": "Vuln\u00e9rable (VU)", "value": "VU"}, {"label": "Quasi menac\u00e9 (NT)", "value": "NT"}, {"label": "Pr\u00e9occupation mineure (LC)", "value": "LC"}], "format": "map", "image_fields": null, "inline_badge": true, "label": "Cat\u00e9gorie UICN", "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": {"CR": "CR", "DD": "DD", "EN": "EN", "LC": "LC", "NE": "NE", "NT": "NT", "VU": "VU"}, "name": "redlist_cat", "searchable": false, "source": "general_info.redlist_cat.value", "tooltip_mapping": {"CR": "En danger critique", "DD": "Donn\u00e9es insuffisantes", "EN": "En danger", "LC": "Pr\u00e9occupation mineure", "NE": "Non \u00e9valu\u00e9", "NT": "Quasi menac\u00e9", "VU": "Vuln\u00e9rable"}, "true_label": null, "type": "select"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": null, "css_style": null, "display": "image_preview", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": null, "format": null, "image_fields": null, "inline_badge": false, "label": null, "link_label": null, "link_target": null, "link_template": null, "link_title": null, "mapping": null, "name": "images", "searchable": false, "source": "general_info.images.value", "tooltip_mapping": null, "true_label": null, "type": "json_array"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": "bg-amber-50 text-green-600 hover:bg-amber-100 px-3 py-1 rounded-md text-sm font-medium no-underline ml-2 transition-colors", "css_style": null, "display": "link", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": null, "format": null, "image_fields": null, "inline_badge": false, "label": null, "link_label": "Endemia", "link_target": "_blank", "link_template": null, "link_title": "Voir sur Endemia", "mapping": null, "name": "endemia_url", "searchable": false, "source": "general_info.endemia_url.value", "tooltip_mapping": null, "true_label": null, "type": "text"}, {"badge_color": null, "badge_colors": null, "badge_style": null, "badge_styles": null, "css_class": "bg-emerald-50 text-teal-600 hover:bg-emerald-100 px-3 py-1 rounded-md text-sm font-medium no-underline ml-2 transition-colors", "css_style": null, "display": "link", "dynamic_options": false, "fallback": null, "false_label": null, "filter_options": null, "format": null, "image_fields": null, "inline_badge": false, "label": null, "link_label": "Florical", "link_target": "_blank", "link_template": "https://publish.plantnet-project.org/project/florical_fr/collection/florical/taxons/details/{value}", "link_title": "Voir sur Florical", "mapping": null, "name": "id_florical", "searchable": false, "source": "general_info.id_florical.value", "tooltip_mapping": null, "true_label": null, "type": "text"}], "group_by": "taxon", "id_column": "taxon_id", "output_pattern": "taxon/{id}.html", "page_config": {"description": "Esp\u00e8ces et sous-esp\u00e8ces de Nouvelle-Cal\u00e9donie", "items_per_page": 24, "title": "Liste des Taxons"}, "views": [{"default": true, "template": null, "type": "grid"}, {"default": false, "template": null, "type": "list"}]};
    const itemsData = [{"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Acmopyle pancheri", "occurrences_count": 142, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 29}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Agathis corbassonii", "occurrences_count": 45, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 30}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Agathis lanceolata", "occurrences_count": 466, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 31}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Agathis montana", "occurrences_count": 64, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 32}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Agathis moorei", "occurrences_count": 247, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 33}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Agathis ovata", "occurrences_count": 498, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 34}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria bernieri", "occurrences_count": 235, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 35}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria bidwillii", "occurrences_count": 2, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 36}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria biramulata", "occurrences_count": 125, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 37}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria columnaris", "occurrences_count": 139, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 38}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria cunninghamii", "occurrences_count": 1, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 39}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria humboldtensis", "occurrences_count": 73, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 40}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria laubenfelsii", "occurrences_count": 85, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 41}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria luxurians", "occurrences_count": 231, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 42}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria montana", "occurrences_count": 643, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 43}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria muelleri", "occurrences_count": 92, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 44}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria nemorosa", "occurrences_count": 67, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 45}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria rulei", "occurrences_count": 254, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 46}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria schmidii", "occurrences_count": 28, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 47}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria scopulorum", "occurrences_count": 183, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 48}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Araucaria subulata", "occurrences_count": 61, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 49}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia deplanchei", "occurrences_count": 137, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 50}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia eriostachys", "occurrences_count": 271, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 51}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia favieri", "occurrences_count": 12, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 52}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia glabrata", "occurrences_count": 180, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 53}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia humboldtiana", "occurrences_count": 22, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 54}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia moorei", "occurrences_count": 3, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 55}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia pancheri", "occurrences_count": 1177, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 56}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia porphyrea", "occurrences_count": 4, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 57}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia sordida", "occurrences_count": 40, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 58}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia tomentosa", "occurrences_count": 3, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 59}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Basselinia velutina", "occurrences_count": 162, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 60}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea balansae", "occurrences_count": 48, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 61}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea comptonii", "occurrences_count": 74, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 62}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea filipes", "occurrences_count": 85, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 63}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea montana", "occurrences_count": 216, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 64}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea neglecta", "occurrences_count": 76, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 65}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea pancheri", "occurrences_count": 138, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 66}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Beauprea spathulifolia", "occurrences_count": 212, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 67}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Burretiokentia dumasii", "occurrences_count": 77, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 68}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Burretiokentia grandiflora", "occurrences_count": 17, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 69}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Burretiokentia hapala", "occurrences_count": 43, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 70}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Burretiokentia koghiensis", "occurrences_count": 79, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 71}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Burretiokentia vieillardii", "occurrences_count": 1202, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 72}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia divaricata", "occurrences_count": 310, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 73}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia houailouensis", "occurrences_count": 1, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 74}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia lepidota", "occurrences_count": 74, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 75}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia macrocarpa", "occurrences_count": 213, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 76}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia magnifica", "occurrences_count": 45, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 77}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia oliviformis", "occurrences_count": 13, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 78}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia piersoniorum", "occurrences_count": 11, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 79}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Chambeyronia pyriformis", "occurrences_count": 65, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 80}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Clinosperma bracteale", "occurrences_count": 104, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 81}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Clinosperma macrocarpa", "occurrences_count": 6, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 82}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cocos nucifera", "occurrences_count": 59, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 83}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphokentia cerifera", "occurrences_count": 69, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 84}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphokentia macrostachya", "occurrences_count": 165, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 85}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphophoenix alba", "occurrences_count": 126, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 86}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphophoenix elegans", "occurrences_count": 31, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 87}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphophoenix fulcita", "occurrences_count": 333, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 88}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphophoenix nucele", "occurrences_count": 374, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 89}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Cyphosperma balansae", "occurrences_count": 47, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 90}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Dacrycarpus vieillardii", "occurrences_count": 90, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 91}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Dacrydium araucarioides", "occurrences_count": 640, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 92}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Dacrydium balansae", "occurrences_count": 205, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 93}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Dacrydium lycopodioides", "occurrences_count": 49, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 94}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Falcatifolium taxoides", "occurrences_count": 260, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 95}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Garnieria spathulifolia", "occurrences_count": 262, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 96}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea deplanchei", "occurrences_count": 13, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 97}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea exul", "occurrences_count": 1004, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 98}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea gillivrayi", "occurrences_count": 1360, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 99}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea macmillanii", "occurrences_count": 7, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 100}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea meisneri", "occurrences_count": 136, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 101}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea mondorensis", "occurrences_count": 12, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 102}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea nepwiensis", "occurrences_count": 28, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 103}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea rubiginosa", "occurrences_count": 23, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 104}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea sinuata", "occurrences_count": 9, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 105}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Kermadecia austrocaledonica", "occurrences_count": 129, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 106}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Kermadecia brinoniae", "occurrences_count": 26, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 107}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Kermadecia pronyensis", "occurrences_count": 80, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 108}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Kermadecia rotundifolia", "occurrences_count": 326, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 109}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Kermadecia sinuata", "occurrences_count": 303, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 110}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Pectinopitys ferruginoides", "occurrences_count": 86, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 111}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Podocarpus colliculatus", "occurrences_count": 12, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 112}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Podocarpus longifoliolatus", "occurrences_count": 24, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 113}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Podocarpus lucienii", "occurrences_count": 326, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 114}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Podocarpus polyspermus", "occurrences_count": 38, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 115}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Podocarpus sylvestris", "occurrences_count": 224, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 116}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Retrophyllum comptonii", "occurrences_count": 391, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 117}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Retrophyllum minus", "occurrences_count": 441, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 118}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Saribus jeanneneyi", "occurrences_count": 11, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 119}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Stenocarpus comptonii", "occurrences_count": 57, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 120}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Stenocarpus milnei", "occurrences_count": 309, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 121}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Stenocarpus rubiginosus", "occurrences_count": 16, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 122}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Stenocarpus tremuloides", "occurrences_count": 33, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 123}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Stenocarpus trinervis", "occurrences_count": 453, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 124}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Virotia francii", "occurrences_count": 81, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 125}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Virotia leptophylla", "occurrences_count": 223, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 126}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Virotia neurophylla", "occurrences_count": 91, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 127}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Virotia rousselii", "occurrences_count": 68, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 128}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Virotia vieillardii", "occurrences_count": 49, "parent_family": null, "parent_genus": null, "rank": "species", "redlist_cat": null, "taxon_id": 129}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Grevillea meisneri var. rhododesmia", "occurrences_count": 11, "parent_family": null, "parent_genus": null, "rank": "infra", "redlist_cat": null, "taxon_id": 130}, {"endemia_url": null, "endemic": null, "id_florical": null, "images": null, "name": "Stenocarpus trinervis var. paradoxus", "occurrences_count": 37, "parent_family": null, "parent_genus": null, "rank": "infra", "redlist_cat": null, "taxon_id": 131}];
    const pageDepth = 1;

    // Variables globales
    let currentPage = 1;
    let filteredItems = [...itemsData];
    let currentView = 'grid';
    const itemsPerPage = indexConfig.page_config.items_per_page || 20;

    // Fonction pour créer des URLs relatives
    function makeRelativeUrl(url) {
        if (!url || typeof url !== 'string') return url;

        // Keep absolute URLs and anchors as is
        if (url.startsWith('http://') || url.startsWith('https://') || url.startsWith('#') ||
            url.startsWith('mailto:') || url.startsWith('javascript:')) {
            return url;
        }

        // Handle root-relative URLs
        if (url.startsWith('/')) {
            // Convert to relative based on depth
            if (pageDepth === 0) {
                return url.substr(1);  // Remove leading slash for root level
            } else {
                return '../'.repeat(pageDepth) + url.substr(1);
            }
        }

        // Already relative URL
        return url;
    }

    // Éléments DOM
    const searchInput = document.getElementById('searchInput');
    const filtersContainer = document.getElementById('filtersContainer');
    const itemsContainer = document.getElementById('itemsContainer');
    const paginationElement = document.getElementById('pagination');
    const resultCountElement = document.getElementById('resultCount');
    const noResultsElement = document.getElementById('noResults');
    const gridViewBtn = document.getElementById('gridViewBtn');
    const listViewBtn = document.getElementById('listViewBtn');

    // Initialisation
    document.addEventListener('DOMContentLoaded', function() {
        generateFilters();
        setupEventListeners();
        applyFiltersAndSort();

        // Restaurer la vue sauvegardée ou initialiser par défaut
        const savedView = localStorage.getItem(`${indexConfig.group_by}ViewPreference`);
        if (savedView) {
            setView(savedView);
        } else {
            setView('grid'); // Vue par défaut
        }
    });

    // Génération dynamique des filtres
    function generateFilters() {
        const filtersHTML = indexConfig.display_fields
            .filter(field => field.type === 'select' || field.type === 'boolean')
            .map(field => {
                if (field.type === 'boolean') {
                    return `
                        <div class="flex-1 min-w-48">
                            <label for="${field.name}Filter" class="block text-sm font-medium text-gray-700 mb-2">${field.label || field.name}</label>
                            <select id="${field.name}Filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                                <option value="all">Tous</option>
                                <option value="true">Oui</option>
                                <option value="false">Non</option>
                            </select>
                        </div>
                    `;
                } else if (field.dynamic_options) {
                    // Générer les options depuis les données
                    const uniqueValues = [...new Set(itemsData
                        .map(item => getFieldValue(item, field))
                        .filter(value => value)
                    )].sort();

                    const optionsHTML = uniqueValues.map(value =>
                        `<option value="${value}">${value}</option>`
                    ).join('');

                    return `
                        <div class="flex-1 min-w-48">
                            <label for="${field.name}Filter" class="block text-sm font-medium text-gray-700 mb-2">${field.label || field.name}</label>
                            <select id="${field.name}Filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                                <option value="all">Tous</option>
                                ${optionsHTML}
                            </select>
                        </div>
                    `;
                } else if (field.filter_options) {
                    const optionsHTML = field.filter_options.map(option =>
                        `<option value="${option.value}">${option.label}</option>`
                    ).join('');

                    return `
                        <div class="flex-1 min-w-48">
                            <label for="${field.name}Filter" class="block text-sm font-medium text-gray-700 mb-2">${field.label || field.name}</label>
                            <select id="${field.name}Filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                                <option value="all">Tous</option>
                                ${optionsHTML}
                            </select>
                        </div>
                    `;
                }
                return '';
            }).join('');

        // Ajouter les contrôles de tri
        const sortHTML = `
            <div class="flex-1 min-w-48">
                <label for="sortBy" class="block text-sm font-medium text-gray-700 mb-2">Trier par</label>
                <select id="sortBy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                    ${indexConfig.display_fields.map(field =>
                        `<option value="${field.name}">${field.label || field.name}</option>`
                    ).join('')}
                </select>
            </div>
            <div class="flex-1 min-w-48">
                <label for="sortOrder" class="block text-sm font-medium text-gray-700 mb-2">Ordre</label>
                <select id="sortOrder" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary text-sm">
                    <option value="asc">Croissant</option>
                    <option value="desc">Décroissant</option>
                </select>
            </div>
        `;

        filtersContainer.innerHTML = filtersHTML + sortHTML;
    }

    // Configuration des event listeners
    function setupEventListeners() {
        searchInput.addEventListener('input', applyFiltersAndSort);

        // Event listeners pour tous les filtres
        filtersContainer.addEventListener('change', applyFiltersAndSort);

        gridViewBtn.addEventListener('click', () => setView('grid'));
        listViewBtn.addEventListener('click', () => setView('list'));
    }

    // Extraction de valeur de champ avec chemins complexes
    function getFieldValue(item, field) {
        if (!field || !field.name) {
            return null;
        }

        // Les données sont déjà extraites par le backend et stockées directement sous field.name
        let value = item[field.name];

        // Si pas de valeur et qu'on a un fallback, essayer le fallback
        if ((value === undefined || value === null) && field.fallback) {
            value = item[field.fallback];
        }

        return value;
    }

    // Application des filtres et tri
    function applyFiltersAndSort() {
        const searchTerm = searchInput.value.toLowerCase().trim();

        // Récupérer les valeurs de tous les filtres
        const filterValues = {};
        indexConfig.display_fields.forEach(field => {
            if (field.type === 'select' || field.type === 'boolean') {
                const filterElement = document.getElementById(`${field.name}Filter`);
                if (filterElement) {
                    filterValues[field.name] = filterElement.value;
                }
            }
        });

        const sortBy = document.getElementById('sortBy')?.value || 'name';
        const sortOrder = document.getElementById('sortOrder')?.value || 'asc';

        // Filtrer les éléments
        filteredItems = itemsData.filter(item => {
            // Filtre de recherche
            const searchableFields = indexConfig.display_fields
                .filter(field => field.searchable)
                .map(field => getFieldValue(item, field))
                .filter(value => value)
                .join(' ')
                .toLowerCase();

            const matchesSearch = !searchTerm || searchableFields.includes(searchTerm);

            // Filtres spécifiques
            const matchesFilters = Object.entries(filterValues).every(([fieldName, filterValue]) => {
                if (filterValue === 'all') return true;

                const field = indexConfig.display_fields.find(f => f.name === fieldName);
                let itemValue = getFieldValue(item, field);

                if (field.type === 'boolean') {
                    // Convert string boolean values to actual booleans for comparison
                    if (typeof itemValue === 'string') {
                        itemValue = itemValue.toLowerCase() === 'true';
                    }
                    return String(itemValue) === filterValue;
                } else {
                    return itemValue === filterValue;
                }
            });

            return matchesSearch && matchesFilters;
        });

        // Trier
        const sortField = indexConfig.display_fields.find(f => f.name === sortBy);
        if (sortField) {
            filteredItems.sort((a, b) => {
                const valueA = getFieldValue(a, sortField);
                const valueB = getFieldValue(b, sortField);

                let comparison = 0;
                if (typeof valueA === 'string' && typeof valueB === 'string') {
                    comparison = valueA.localeCompare(valueB);
                } else {
                    comparison = (valueA || 0) - (valueB || 0);
                }

                return sortOrder === 'desc' ? -comparison : comparison;
            });
        }

        currentPage = 1;
        renderItems();
    }

    // Rendu des éléments
    function renderItems() {
        if (filteredItems.length === 0) {
            itemsContainer.innerHTML = '';
            paginationElement.innerHTML = '';
            noResultsElement.classList.remove('hidden');
            resultCountElement.textContent = 'Aucun élément trouvé';
            return;
        }

        noResultsElement.classList.add('hidden');

        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, filteredItems.length);
        const currentItems = filteredItems.slice(startIndex, endIndex);

        resultCountElement.textContent = `Affichage de ${startIndex + 1}-${endIndex} sur ${filteredItems.length} éléments`;

        if (currentView === 'grid') {
            renderGridView(currentItems);
        } else {
            renderListView(currentItems);
        }

        renderPagination();
    }

    // Vue grille générique
    function renderGridView(items) {
        itemsContainer.className = "items-grid";

        // Reset styles
        itemsContainer.style.display = '';
        itemsContainer.style.gridTemplateColumns = '';
        itemsContainer.style.gap = '';
        itemsContainer.style.flexDirection = '';

        itemsContainer.innerHTML = items.map(item => {
            const imageField = indexConfig.display_fields.find(f => f.display === 'image_preview' || f.type === 'json_array');
            const imageUrl = getImageUrl(item, imageField);
            const nameField = indexConfig.display_fields.find(f => f.name === 'name');
            const itemName = getFieldValue(item, nameField) || item[indexConfig.id_column];

            // Ne pas afficher la section image si aucun champ d'image n'est configuré
            const hasImageField = imageField !== undefined;

            return `
            <div class="item-card">
                <div class="item-card-content">
                    ${hasImageField ? `
                    <!-- Image à gauche pour desktop, en haut pour mobile -->
                    <div class="item-card-image-container">
                        ${imageUrl ?
                            `<div class="item-card-image" style="background-image: url('${imageUrl}')"></div>` :
                            '<div class="item-card-image-placeholder">Aucune image</div>'
                        }
                    </div>
                    ` : ''}

                    <!-- Informations à droite pour desktop, en bas pour mobile -->
                    <div class="item-card-info">
                        <h3 class="item-name">
                            <a href="${item[indexConfig.id_column]}.html">${itemName}</a>
                        </h3>
                        <div class="flex flex-wrap gap-2 mb-3">
                            ${renderInlineBadges(item)}
                        </div>

                        <div class="item-details">
                            ${renderItemFields(item)}
                        </div>

                        <div class="flex flex-wrap gap-2 mt-3">
                            ${renderFieldLinks(item)}
                        </div>
                    </div>
                </div>
            </div>
            `;
        }).join('');
    }

    // Vue liste générique
    function renderListView(items) {
        itemsContainer.className = "items-list";

        // Appliquer les styles directement via JavaScript
        itemsContainer.style.display = 'flex';
        itemsContainer.style.flexDirection = 'column';
        itemsContainer.style.gap = '1rem';
        itemsContainer.style.gridTemplateColumns = ''; // Reset grid styles
        itemsContainer.innerHTML = items.map(item => {
            const imageField = indexConfig.display_fields.find(f => f.display === 'image_preview' || f.type === 'json_array');
            const imageUrl = getImageUrl(item, imageField);
            const nameField = indexConfig.display_fields.find(f => f.name === 'name');
            const itemName = getFieldValue(item, nameField) || item[indexConfig.id_column];

            // Ne pas afficher la section image si aucun champ d'image n'est configuré
            const hasImageField = imageField !== undefined;

            return `
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:shadow-md transition-shadow duration-200">
                <!-- Zone principale : texte à gauche, images à droite -->
                <div class="flex">
                    <!-- Texte à gauche -->
                    <div class="${hasImageField ? 'flex-1 pr-6' : 'flex-1'}">
                        <a href="${item[indexConfig.id_column]}.html"
                           class="text-primary hover:text-green-700 font-semibold text-lg transition-colors block mb-2">
                            ${itemName}
                        </a>
                        <div class="flex flex-wrap gap-2 mb-3">
                            ${renderInlineBadges(item)}
                        </div>
                        ${renderItemFields(item, true)}
                    </div>

                    ${hasImageField ? `
                    <!-- Images à droite -->
                    <div class="flex-shrink-0" style="width: 450px;">
                        ${renderListViewImageGallery(item, imageField)}
                    </div>
                    ` : ''}
                </div>

                <!-- Liens en bas -->
                <div class="mt-4 pt-4 border-t border-gray-100">
                    ${renderFieldLinks(item)}
                </div>
            </div>
            `;
        }).join('');
    }

    // Rendu des champs d'un élément
    function renderItemFields(item, inline = false) {
        return indexConfig.display_fields
            .filter(field => field.name !== 'name' && field.display !== 'hidden' && field.display !== 'image_preview' && field.display !== 'link' && field.type !== 'json_array')
            .map(field => {
                const value = getFieldValue(item, field);
                const label = field.label || field.name;
                const displayValue = formatFieldValue(value, field);

                if (inline) {
                    return `<div class="mt-2"><span class="text-gray-500 text-sm">${label}: <span class="font-medium text-gray-700">${displayValue}</span></span></div>`;
                } else {
                    return `
                        <div class="item-info">
                            <span class="item-info-label">${label}:</span>
                            <span class="item-info-value">${displayValue}</span>
                        </div>
                    `;
                }
            }).join('');
    }

    // Formatage des valeurs de champs
    function formatFieldValue(value, field) {
        // Handle null/undefined values
        if (value === null || value === undefined) {
            return '<span class="text-gray-400 italic">-</span>';
        }

        // Convert string boolean values to actual booleans for comparison
        if (field.type === 'boolean' && typeof value === 'string') {
            value = value.toLowerCase() === 'true';
        }

        switch (field.format) {
            case 'badge':
                if (field.type === 'boolean') {
                    const label = value === true ? (field.true_label || 'Oui') : (field.false_label || 'Non');
                    const colorClass = value === true ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600';
                    return `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${colorClass}">${label}</span>`;
                }
                return value;
            case 'map':
                if (field.mapping && field.mapping[value]) {
                    return field.mapping[value];
                }
                return value;
            case 'number':
                return new Intl.NumberFormat('fr-FR').format(value);
            default:
                return value;
        }
    }

    // Rendu des badges inline dans le titre
    function renderInlineBadges(item) {
        return indexConfig.display_fields
            .filter(field => field.inline_badge === true)
            .map(field => {
                let value = getFieldValue(item, field);
                if (value === null || value === undefined) return '';

                // Convert string boolean values to actual booleans
                if (field.type === 'boolean' && typeof value === 'string') {
                    value = value.toLowerCase() === 'true';
                }

                return formatInlineBadge(value, field);
            })
            .filter(badge => badge !== '')
            .join('');
    }

    // Formatage des badges inline
    function formatInlineBadge(value, field) {

        switch (field.format) {
            case 'badge':
                if (field.type === 'boolean' && value === true) {
                    const label = field.true_label || field.label || 'Oui';
                    const styleValue = field.badge_color || field.badge_style;

                    // Create the badge with proper class combination
                    if (styleValue && styleValue.includes(':')) {
                        // Inline style
                        return `<span class="field-badge" style="${styleValue}">${label}</span>`;
                    } else if (styleValue) {
                        // CSS classes - combine with field-badge
                        return `<span class="field-badge ${styleValue}">${label}</span>`;
                    } else {
                        // Default styling
                        return `<span class="field-badge">${label}</span>`;
                    }
                }
                break;
            case 'map':
                if (field.mapping && field.mapping[value]) {
                    const label = field.mapping[value];
                    const styleValue = (field.badge_colors && field.badge_colors[value]) ||
                                     (field.badge_styles && field.badge_styles[value]) ||
                                     'bg-gray-600 text-white';
                    const tooltip = field.tooltip_mapping && field.tooltip_mapping[value] || '';

                    // Create the badge with proper class combination
                    let badgeHtml;
                    if (styleValue.includes(':')) {
                        // Inline style
                        badgeHtml = `<span class="field-badge" style="${styleValue}" title="${tooltip}">${label}</span>`;
                    } else {
                        // CSS classes - combine with field-badge
                        badgeHtml = `<span class="field-badge ${styleValue}" title="${tooltip}">${label}</span>`;
                    }

                    return badgeHtml;
                }
                break;
            default:
                if (field.badge_color || field.badge_style) {
                    const styleValue = field.badge_color || field.badge_style;

                    // Create the badge with proper class combination
                    if (styleValue.includes(':')) {
                        // Inline style
                        return `<span class="field-badge" style="${styleValue}">${value}</span>`;
                    } else {
                        // CSS classes - combine with field-badge
                        return `<span class="field-badge ${styleValue}">${value}</span>`;
                    }
                }
        }
        return '';
    }


    // Gestion des vues
    function setView(viewType) {
        currentView = viewType;

        if (viewType === 'grid') {
            gridViewBtn.classList.add('bg-green-600', 'text-white');
            gridViewBtn.classList.remove('bg-white', 'text-gray-700');
            listViewBtn.classList.remove('bg-green-600', 'text-white');
            listViewBtn.classList.add('bg-white', 'text-gray-700');
        } else {
            listViewBtn.classList.add('bg-green-600', 'text-white');
            listViewBtn.classList.remove('bg-white', 'text-gray-700');
            gridViewBtn.classList.remove('bg-green-600', 'text-white');
            gridViewBtn.classList.add('bg-white', 'text-gray-700');
        }

        localStorage.setItem(`${indexConfig.group_by}ViewPreference`, viewType);
        renderItems();
    }

    // Pagination
    function renderPagination() {
        const totalPages = Math.ceil(filteredItems.length / itemsPerPage);

        if (totalPages <= 1) {
            paginationElement.innerHTML = '';
            return;
        }

        const buttonClasses = "px-3 py-2 mx-1 text-sm border border-gray-300 rounded-md bg-white hover:bg-gray-50 focus:ring-2 focus:ring-primary focus:border-primary transition-colors";
        const activeButtonClasses = "px-3 py-2 mx-1 text-sm border border-primary rounded-md bg-primary text-white bg-green-600 hover:bg-green-700 transition-colors";
        const disabledButtonClasses = "px-3 py-2 mx-1 text-sm border border-gray-300 rounded-md bg-gray-100 text-gray-400 cursor-not-allowed";

        let paginationHTML = `
            <button onclick="goToPage(1)" class="${currentPage === 1 ? disabledButtonClasses : buttonClasses}" ${currentPage === 1 ? 'disabled' : ''}>
                « Premier
            </button>
            <button onclick="goToPage(${currentPage - 1})" class="${currentPage === 1 ? disabledButtonClasses : buttonClasses}" ${currentPage === 1 ? 'disabled' : ''}>
                ‹ Précédent
            </button>
        `;

        const maxPagesToShow = 5;
        let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
        let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);

        for (let i = startPage; i <= endPage; i++) {
            paginationHTML += `
                <button onclick="goToPage(${i})" class="${i === currentPage ? activeButtonClasses : buttonClasses}">
                    ${i}
                </button>
            `;
        }

        paginationHTML += `
            <button onclick="goToPage(${currentPage + 1})" class="${currentPage === totalPages ? disabledButtonClasses : buttonClasses}" ${currentPage === totalPages ? 'disabled' : ''}>
                Suivant ›
            </button>
            <button onclick="goToPage(${totalPages})" class="${currentPage === totalPages ? disabledButtonClasses : buttonClasses}" ${currentPage === totalPages ? 'disabled' : ''}>
                Dernier »
            </button>
        `;

        paginationElement.innerHTML = paginationHTML;
    }

    function goToPage(page) {
        currentPage = page;
        renderItems();
        window.scrollTo({ top: itemsContainer.offsetTop - 100, behavior: 'smooth' });
    }

    // Obtenir l'URL de l'image si disponible
    function getImageUrl(item, imageField) {
        if (!imageField) return null;

        const imageData = getFieldValue(item, imageField);
        if (!imageData) return null;

        // Si c'est une URL directe
        if (typeof imageData === 'string' && (imageData.startsWith('http') || imageData.startsWith('/'))) {
            return imageData;
        }

        // Utiliser les champs configurés ou les valeurs par défaut
        const thumbField = imageField?.image_fields?.thumbnail || 'small_thumb';
        const urlField = imageField?.image_fields?.url || 'url';

        // Si c'est un tableau d'images
        if (Array.isArray(imageData) && imageData.length > 0) {
            // Parcourir les images pour trouver la première valide
            for (const img of imageData) {
                if (typeof img === 'string' && img) return img;

                if (img && typeof img === 'object') {
                    // Vérifier si l'objet a au moins une valeur non null
                    const hasValidData = Object.values(img).some(val => val !== null && val !== undefined && val !== '');
                    if (!hasValidData) continue;

                    // Chercher une URL valide
                    const url = img[thumbField] || img[urlField] || img.small_thumb || img.url;
                    if (url && url !== '') return url;
                }
            }
            // Si aucune image valide n'est trouvée
            return null;
        }

        // Si c'est un objet avec une URL
        if (typeof imageData === 'object' && !Array.isArray(imageData)) {
            // Vérifier si l'objet a toutes les valeurs à null
            const hasValidData = Object.values(imageData).some(val => val !== null && val !== undefined);
            if (!hasValidData) return null;

            const url = imageData[thumbField] || imageData[urlField] || imageData.small_thumb || imageData.url;
            return (url && url !== '') ? url : null;
        }

        return null;
    }

    // Rendu des images pour la vue liste en galerie
    function renderListViewImageGallery(item, imageField) {
        if (!imageField) {
            return '<div class="text-center text-gray-400 text-sm py-4">Aucune image disponible</div>';
        }

        const imageData = getFieldValue(item, imageField);
        if (!imageData) {
            return '<div class="text-center text-gray-400 text-sm py-4">Aucune image disponible</div>';
        }

        let allImages = [];
        let displayImages = [];

        // Si c'est une URL directe
        if (typeof imageData === 'string' && (imageData.startsWith('http') || imageData.startsWith('/'))) {
            allImages = [imageData];
            displayImages = [imageData];
        }
        // Si c'est un tableau d'images
        else if (Array.isArray(imageData)) {
            // Utiliser les champs configurés ou les valeurs par défaut
            const thumbField = imageField?.image_fields?.thumbnail || 'small_thumb';
            const urlField = imageField?.image_fields?.url || 'url';

            allImages = imageData
                .map(img => {
                    if (typeof img === 'string') return img;
                    // Vérifier si l'objet a toutes les valeurs à null
                    if (img && typeof img === 'object') {
                        const hasValidData = Object.values(img).some(val => val !== null && val !== undefined);
                        if (!hasValidData) return null;
                    }
                    // Essayer d'abord le champ configuré, puis les fallbacks
                    return img[thumbField] || img[urlField] || img.small_thumb || img.url || null;
                })
                .filter(url => url !== null && url !== undefined && url !== ''); // Filtrer les valeurs nulles
            displayImages = allImages.slice(0, 10);
        }
        // Si c'est un objet avec une URL
        else if (typeof imageData === 'object' && imageData.url) {
            const thumbField = imageField?.image_fields?.thumbnail || 'small_thumb';
            const urlField = imageField?.image_fields?.url || 'url';
            allImages = [imageData[thumbField] || imageData[urlField] || imageData.small_thumb || imageData.url];
            displayImages = allImages;
        }

        if (allImages.length === 0) {
            return '<div class="text-center text-gray-400 text-sm py-4">Aucune image disponible</div>';
        }

        const itemId = item[indexConfig.id_column];
        const galleryId = `gallery-${itemId}`;

        // Préparer les URLs pour la modal (big_thumb)
        const fullField = imageField?.image_fields?.full || 'big_thumb';
        const urlField = imageField?.image_fields?.url || 'url';

        const modalImages = Array.isArray(imageData) ?
            imageData.map(img => {
                if (typeof img === 'string') return img;
                return img[fullField] || img[urlField] || img.big_thumb || img.url || img;
            }) :
            allImages;

        // Créer une grille d'images pour la zone droite
        const imageElements = displayImages.map((imageUrl, index) => {
            return `
                <div class="w-20 h-20 bg-cover bg-center rounded border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity"
                     style="background-image: url('${imageUrl}')"
                     title="Image ${index + 1}"
                     onclick="openImageLightbox(${JSON.stringify(modalImages).replace(/"/g, '&quot;')}, ${index})">
                </div>
            `;
        }).join('');

        // Images supplémentaires cachées
        const hiddenImages = allImages.slice(10).map((imageUrl, index) => {
            return `
                <div class="w-20 h-20 bg-cover bg-center rounded border border-gray-200 cursor-pointer hover:opacity-80 transition-opacity hidden gallery-hidden"
                     style="background-image: url('${imageUrl}')"
                     title="Image ${index + 11}"
                     onclick="openImageLightbox(${JSON.stringify(modalImages).replace(/"/g, '&quot;')}, ${index + 10})">
                </div>
            `;
        }).join('');

        const remainingCount = allImages.length - displayImages.length;
        const expandButton = remainingCount > 0 ? `
            <div class="w-20 h-20 bg-gray-100 rounded border border-gray-200 flex items-center justify-center text-gray-500 text-sm font-medium cursor-pointer hover:bg-gray-200 transition-colors expand-btn"
                 onclick="expandImageGallery('${galleryId}', this)">
                +${remainingCount}
            </div>
        ` : '';

        const collapseButton = remainingCount > 0 ? `
            <div class="w-20 h-20 bg-gray-100 rounded border border-gray-200 flex items-center justify-center text-gray-500 text-sm font-medium cursor-pointer hover:bg-gray-200 transition-colors collapse-btn hidden"
                 onclick="collapseImageGallery('${galleryId}', this)">
                −
            </div>
        ` : '';

        return `
            <div id="${galleryId}" class="grid grid-cols-5 gap-2">
                ${imageElements}
                ${hiddenImages}
                ${expandButton}
                ${collapseButton}
            </div>
        `;
    }

    // Rendu des liens basés sur les champs
    function renderFieldLinks(item) {
        const linkFields = indexConfig.display_fields.filter(field => field.display === 'link');

        if (linkFields.length === 0) {
            return '';
        }

        const links = linkFields
            .map(field => {
                const value = getFieldValue(item, field);
                if (!value) return '';

                let finalUrl;
                if (field.link_template) {
                    // Use template with placeholder replacement
                    finalUrl = field.link_template.replace('{value}', value);
                } else {
                    // Use direct URL
                    finalUrl = value;
                }

                const label = field.link_label || field.label || field.name;
                const cssClass = field.css_class || 'external-link';
                const cssStyle = field.css_style ? `style="${field.css_style}"` : '';
                const title = field.link_title ? `title="${field.link_title}"` : '';
                const target = field.link_target ? `target="${field.link_target}"` : 'target="_blank"';

                return `<a href="${finalUrl}" class="${cssClass}" ${cssStyle} ${title} ${target}>${label}</a>`;
            })
            .filter(link => link !== '');

        if (links.length === 0) return '';

        return links.join(' ');
    }

    // Fonction pour expandre la galerie d'images
    function expandImageGallery(galleryId, button) {
        const gallery = document.getElementById(galleryId);
        const hiddenImages = gallery.querySelectorAll('.gallery-hidden');
        const expandBtn = gallery.querySelector('.expand-btn');
        const collapseBtn = gallery.querySelector('.collapse-btn');

        // Afficher toutes les images cachées
        hiddenImages.forEach(img => img.classList.remove('hidden'));

        // Masquer le bouton + et afficher le bouton −
        expandBtn.classList.add('hidden');
        collapseBtn.classList.remove('hidden');
    }

    // Fonction pour réduire la galerie d'images
    function collapseImageGallery(galleryId, button) {
        const gallery = document.getElementById(galleryId);
        const hiddenImages = gallery.querySelectorAll('.gallery-hidden');
        const expandBtn = gallery.querySelector('.expand-btn');
        const collapseBtn = gallery.querySelector('.collapse-btn');

        // Masquer les images supplémentaires
        hiddenImages.forEach(img => img.classList.add('hidden'));

        // Afficher le bouton + et masquer le bouton −
        expandBtn.classList.remove('hidden');
        collapseBtn.classList.add('hidden');
    }

    // Variables globales pour la navigation dans la modal
    let currentImageArray = [];
    let currentImageIndex = 0;

    // Fonction pour ouvrir une image en grand dans la modal
    function openImageLightbox(images, startIndex = 0) {
        currentImageArray = images;
        currentImageIndex = startIndex;

        showCurrentImage();

        const modal = document.getElementById('imageModal');
        modal.classList.remove('hidden');
        document.body.style.overflow = 'hidden'; // Empêcher le scroll de la page

        updateNavigationButtons();
    }

    // Fonction pour afficher l'image actuelle
    function showCurrentImage() {
        const modalImage = document.getElementById('modalImage');
        const imageLoader = document.getElementById('imageLoader');
        const currentIndexSpan = document.getElementById('currentImageIndex');
        const totalImagesSpan = document.getElementById('totalImages');

        // Afficher le loader et cacher l'image
        imageLoader.classList.remove('hidden');
        modalImage.classList.add('hidden');

        // Mettre à jour les compteurs
        currentIndexSpan.textContent = currentImageIndex + 1;
        totalImagesSpan.textContent = currentImageArray.length;

        // Charger la nouvelle image
        const newImage = new Image();
        newImage.onload = function() {
            // Une fois l'image chargée, l'afficher et cacher le loader
            modalImage.src = newImage.src;
            imageLoader.classList.add('hidden');
            modalImage.classList.remove('hidden');
        };
        newImage.onerror = function() {
            // En cas d'erreur, afficher un message et cacher le loader
            imageLoader.innerHTML = '<div class="text-white text-center"><p>Erreur de chargement</p><p class="text-sm opacity-75">Image non disponible</p></div>';
            setTimeout(() => {
                imageLoader.innerHTML = '<div class="animate-spin rounded-full h-16 w-16 border-b-2 border-white"></div>';
                imageLoader.classList.add('hidden');
            }, 2000);
        };
        newImage.src = currentImageArray[currentImageIndex];

        // Afficher/masquer le compteur et les flèches selon le nombre d'images
        const imageCounter = document.getElementById('imageCounter');
        const prevBtn = document.getElementById('prevImageBtn');
        const nextBtn = document.getElementById('nextImageBtn');

        if (currentImageArray.length > 1) {
            imageCounter.classList.remove('hidden');
            prevBtn.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
        } else {
            imageCounter.classList.add('hidden');
            prevBtn.classList.add('hidden');
            nextBtn.classList.add('hidden');
        }
    }

    // Fonction pour mettre à jour les boutons de navigation
    function updateNavigationButtons() {
        const prevBtn = document.getElementById('prevImageBtn');
        const nextBtn = document.getElementById('nextImageBtn');

        // Désactiver/activer les boutons selon la position
        if (currentImageIndex === 0) {
            prevBtn.style.opacity = '0.5';
            prevBtn.style.cursor = 'not-allowed';
        } else {
            prevBtn.style.opacity = '1';
            prevBtn.style.cursor = 'pointer';
        }

        if (currentImageIndex === currentImageArray.length - 1) {
            nextBtn.style.opacity = '0.5';
            nextBtn.style.cursor = 'not-allowed';
        } else {
            nextBtn.style.opacity = '1';
            nextBtn.style.cursor = 'pointer';
        }
    }

    // Fonction pour aller à l'image précédente
    function previousImage() {
        if (currentImageIndex > 0) {
            currentImageIndex--;
            showCurrentImage();
            updateNavigationButtons();
        }
    }

    // Fonction pour aller à l'image suivante
    function nextImage() {
        if (currentImageIndex < currentImageArray.length - 1) {
            currentImageIndex++;
            showCurrentImage();
            updateNavigationButtons();
        }
    }

    // Fonction pour fermer la modal
    function closeImageModal() {
        const modal = document.getElementById('imageModal');
        modal.classList.add('hidden');
        document.body.style.overflow = ''; // Restaurer le scroll
    }

    // Fermer la modal en cliquant en dehors de l'image
    document.getElementById('imageModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeImageModal();
        }
    });

    // Navigation au clavier
    document.addEventListener('keydown', function(e) {
        const modal = document.getElementById('imageModal');
        if (!modal.classList.contains('hidden')) {
            switch(e.key) {
                case 'Escape':
                    closeImageModal();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    previousImage();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    nextImage();
                    break;
            }
        }
    });

</script>

</body>
</html>